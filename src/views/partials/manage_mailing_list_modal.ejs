<div id="manage-mailing-list-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header-listing">
        <div class="modal-title-mailing">
          <span id="myModalLabel">MANAGE MAILING LIST</span>
        </div>
        <button type="button" class="close-modal" data-dismiss="modal" style="color: #fff;" aria-label="Close">
          <span aria-hidden="true" style="color:#fff">X</span>
        </button>
      </div>
      <div class="modal-body-mailing">
        <br>
        <div name="mailing-list-title" class="manage-email-alias-modal-title">
          Mailing List Participants
        </div>
        <div class="modal-body-mailing-list-admin">
          <br>
          <div id="participants_div">
          </div>
          <br>
        </div>
        <form class="" action="/addParticipantToMailingList/<%= project.id %>" method="post">
          <div class="col-sm-12 content">
            <div class="col-sm-12 content">
              <input type="text" name="participant_email" class="modal-email-address-input" placeholder="Add Participant Email Address">
              <input type="hidden" id="mailing_list_id" name="mailing_list_id">
              <input type="hidden" id="mailing_list_name" name="mailing_list_name">
            </div>
          </div>
          <div class="col-sm-12 text-center">
            <div class="col-sm-12 content">
                <input type="submit" class="btn btn-primary" style="margin-top:30px; margin-bottom:20px; width:30%" value="Add Participant">
            </div>
          </div>
        </form>

        <div class="col-sm-12 text-center">
          <div class="hr-divider-keyline"></div>
            <a id="remove_mailing_list" name="remove_mailing_list" href="/removeMailingList/<%= project.id %>/">
              <button type="button" name="button" class="btn btn-danger" style="margin-top:20px; margin-bottom:40px; width:30%">Delete Mailing List</button>
            </a>
        </div>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
  $('#manage-mailing-list-modal').on('show.bs.modal', function (event) {
    var button = $(event.relatedTarget);
    var participants = button.data('participants');
    var mailingListName = button.data('mailing-list-name');
    var mailingListId = button.data('mailing-list-id');
    var modal = $(this);
    modal.find('[name=mailing-list-title]').text(mailingListName  + " participants");
    $('#mailing_list_id').val(mailingListId);
    $('#mailing_list_name').val(mailingListName);
    $('#remove_mailing_list').attr("href", "/removeMailingList/<%= project.id %>/" + mailingListName)
    $("#participants_table").remove();
    $('#participants_div').append(  '<table id="participants_table" class="table" />' );
    $('#participants_div table')
    .append( '<tr>' +
      '<td><strong>Email</strong></td>'+
      '<td><strong>Remove</strong></td>'+
    '</tr>' );
    if(participants.length >= 1){
      for(i=0; i<participants.length; i++){
        $('#participants_div table')
        .append( '<tr>'+
          '<td>' + participants[i].address + '</td>' +
          '<td> &nbsp  &nbsp &nbsp <a href="/removeParticipantFromMailingList/<%= project.id %>/' +
          mailingListName + '/' + encodeURI(participants[i].address) + '"> &times; </a> </td>' +
        '</tr>' );
      }
    }
  });
</script>
