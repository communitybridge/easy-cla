# List of all the containers that needs to be spun up.
# The workspace container will be added and configured automatically.
# The Syntax for each container should mimic the docker-compose format.
containers:
  redis:
    image: '433610389961.dkr.ecr.us-west-2.amazonaws.com/redis:latest'
    volumes: ['.lf/logs/redis:/var/log/redis']
  workspace:
    image: '433610389961.dkr.ecr.us-west-2.amazonaws.com/cli/workspace/node:6'
    ports: ['%:8081']
    internal_volumes: ['app']

# Environment Variables to be injected in the container.
environment:
  workspace:
    encryption_sauce: 'WqNGjk@%ym7eRsXGAZYskF'
    redis_host: 'redis'
    redis_port: '6379'

modes:
  default:
    description: "Only the workspace container will have have an external port mappings. App will autorun in workspace."
    containers:
      workspace:
        command: '/srv/app/scripts/run.sh'
        environment:
          OPENING_SEQUENCE: "/srv/app/scripts/install.sh"

  dev:
    description: "All containers will have external port mappings. No autorun."
    containers:
      workspace:
        environment:
          OPENING_SEQUENCE: "/srv/app/scripts/install.sh"
      redis:
        ports: ['%:6379']

  ci:
    description: "All containers are launched, including the workspace but no port mappings are set and no autorun"
    containers:
      workspace:
        environment:
          OPENING_SEQUENCE: "/srv/app/scripts/generate-constants.sh"
